version: 1
frontend:
  phases:
    preBuild:
      commands:
        - nvm install 22.18.0
        - nvm use 22.18.0

        # bun 1.3.5 install
        - curl -fsSL https://bun.sh/install | BUN_VERSION=1.3.5 bash
        - export BUN_INSTALL="$HOME/.bun"
        - export PATH="$BUN_INSTALL/bin:$PATH"
        - bun --version

        # install deps (bun.lock / bun.lockb がある前提)
        - bun install --frozen-lockfile

    build:
      commands:
        - export BUN_INSTALL="$HOME/.bun"
        - export PATH="$BUN_INSTALL/bin:$PATH"

        - env > .env.production
        - bun run vercel-build

  artifacts:
    baseDirectory: .next
    files:
      - "**/*"

  cache:
    paths:
      - .next/cache/**/*
      - node_modules/**/*
      - ~/.bun/install/cache/**/*
