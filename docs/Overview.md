# Mitsumori Gate Overview

このドキュメントは、開発者向けの細かい実装ではなく「何をするプロダクトか」「どんな流れで使うか」を共有するための概要です。詳細な質問項目は `docs/hearingList.xlsx` にまとまっており、Web/対面フォームはこれに沿ってヒアリングします。

## プロダクトの目的と価値
- 住宅購入検討者のヒアリングを、事前の自己入力と来店時の追加入力で効率化する。
- 入力内容から借入可能額・希望条件での借入額・建築予算目安を算出し、PDFレポートを即時返送することで信頼感を高め、来店につなげる。
- 顧客データと計算条件を一元管理し、担当者間の引き継ぎコストを下げる。

## 想定するユーザーストーリー
- 公式サイトから「事前シミュレーション」へ遷移し、オンラインで自己入力を完了する。
- 完了時にPDF付きメールを受け取り、来店案内のコミュニケーションを取る。
- 来店時はスタッフが対面フォームを開き、オンライン入力の続き/上書きを行う。
- 社内は管理画面で顧客と試算結果を確認し、設定値（利率・DTI・坪単価）を調整する。

## 主要なUIフロー
- **Web自己入力**: `/consent?mode=web` → `/web-form` → `/done?mode=web`  
  1問1画面のステップ式。配偶者/ボーナスの有無に応じてステップをスキップ。完了時に顧客と試算結果を保存し、メールアドレスがあればPDFを自動送付。
- **対面入力**: `/inperson-form`（または `/consent?mode=inperson` 経由）  
  既存顧客を検索して読み込み、足りない情報を埋めて試算。既存レコードが選択されている場合は上書き保存し、対面完了フラグを付与。
- **管理画面**: `/admin`（Basic認証）で最新顧客一覧と完了状況を確認。`/admin/config` で利率・DTI・坪単価を編集できる。

## ヒアリング項目の出典
- `docs/hearingList.xlsx` に質問リストがまとまっている。Web/対面フォームはこのリストをベースに実装しており、変更があればここを更新する。

## 出力と通知
- Web完了時に顧客・シミュレーション結果をDBへ保存し、PDFレポートをResend経由で送信（環境変数未設定時はスキップ）。
- 対面フローではPDF送信は必須ではなく、主に顧客データ更新と試算確認に使う。

## データの扱い
- 顧客情報は `Customer`、試算結果は `Simulation` としてDBに保存。入力経路は `webCompleted` / `inPersonCompleted` で識別。
- 試算時の利率・DTI・坪単価は `AppConfig` に保持し、管理画面から変更可能。空の場合は初回アクセス時にデフォルトを投入。

## 運用メモ
- 事前入力が未完の場合でも、対面フォームで検索して続きを入力できる。
- 郵便番号検索は外部API（zipcloud）を使うため、ネットワーク遮断環境では手入力で進める。***
