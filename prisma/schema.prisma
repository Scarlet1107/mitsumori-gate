// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 顧客のヒアリング情報を管理するメインテーブル
model Customer {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // 基本情報
  name       String
  email      String?
  phone      String?
  postalCode String? @map("postal_code")
  address    String?
  age        Int?

  // 配偶者情報
  hasSpouse Boolean? @map("has_spouse")

  // 収入情報
  ownIncome    Int? @map("own_income")
  spouseIncome Int? @map("spouse_income")

  // 借入情報
  ownLoanPayment    Int? @map("own_loan_payment")
  spouseLoanPayment Int? @map("spouse_loan_payment")

  // 頭金・返済希望
  downPayment        Int? @map("down_payment")
  wishMonthlyPayment Int? @map("wish_monthly_payment")
  wishPaymentYears   Int? @map("wish_payment_years")

  // その他条件
  usesBonus           Boolean? @map("uses_bonus")
  hasLand             Boolean? @map("has_land")
  usesTechnostructure Boolean? @map("uses_technostructure")

  // 入力方式（web/inperson）
  inputMode String @default("web") @map("input_mode")

  // Web入力完了状態、対面入力完了状態
  webCompleted      Boolean @default(false) @map("web_completed")
  inPersonCompleted Boolean @default(false) @map("in_person_completed")

  // 関連するシミュレーション結果
  simulations Simulation[]

  @@index([name])
  @@index([createdAt])
  @@map("customers")
}

// シミュレーション結果保存テーブル
model Simulation {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  customerId String   @map("customer_id") @db.Uuid
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  // 計算結果
  maxLoanAmount         Float? @map("max_loan_amount")
  wishLoanAmount        Float? @map("wish_loan_amount")
  totalBudget           Float? @map("total_budget")
  buildingBudget        Float? @map("building_budget")
  estimatedTsubo        Float? @map("estimated_tsubo")
  estimatedSquareMeters Float? @map("estimated_square_meters")

  // 計算時の設定値（スナップショット）
  interestRate      Float? @map("interest_rate")
  dtiRatio          Float? @map("dti_ratio")
  unitPricePerTsubo Int?   @map("unit_price_per_tsubo")

  @@index([customerId])
  @@index([createdAt])
  @@map("simulations")
}

// アプリ全体の設定値管理テーブル
model AppConfig {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  key         String  @unique
  value       String
  description String?

  @@map("app_configs")
}
